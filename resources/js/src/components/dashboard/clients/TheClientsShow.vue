<template>
    <div v-if="!isLoading" class="ml-2 mt-2">

        <div class="sticky top-0 p-1 mb-1 bg-blue-200 border-2 rounded-lg border-blue-700 max-w-fit">

            <div class="flex">

                <div>
                    <!-- __ id -->
                    <AppLabelMultiLineTS
                        v-if="render.id.show"
                        :align="render.id.headerAlign"
                        :text="render.id.header"
                        :text-size="render.id.headerTextSize"
                        :type="typeof render.id.type === 'function' ? render.id.type() : render.id.type"
                        :width="render.id.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: id -->
                    <AppInputTextTS
                        v-if="render.id.show"
                        id="id-search"
                        v-model:text-value.trim="idFilter"
                        :text-size="render.id.filterTextSize"
                        :type="typeof render.id.type === 'function' ? render.id.type() : render.id.type"
                        :width="render.id.width"
                        placeholder="üîçid..."
                    />
                </div>

                <div>
                    <!-- __ –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppLabelMultiLineTS
                        v-if="render.name.show"
                        :align="render.name.headerAlign"
                        :text="render.name.header"
                        :text-size="render.name.headerTextSize"
                        :type="typeof render.name.type === 'function' ? render.name.type() : render.name.type"
                        :width="render.name.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppInputTextTS
                        v-if="render.name.show"
                        id="name-search"
                        v-model:text-value.trim="nameFilter"
                        :text-size="render.name.filterTextSize"
                        :type="typeof render.name.type === 'function' ? render.name.type() : render.name.type"
                        :width="render.name.width"
                        placeholder="üîç–ù–∞–∑–≤–∞–Ω–∏–µ..."
                    />
                </div>

                <div>
                    <!-- __ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppLabelMultiLineTS
                        v-if="render.addName.show"
                        :align="render.addName.headerAlign"
                        :text="render.addName.header"
                        :text-size="render.addName.headerTextSize"
                        :type="typeof render.addName.type === 'function' ? render.addName.type() : render.addName.type"
                        :width="render.addName.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppInputTextTS
                        v-if="render.addName.show"
                        id="id-add-name-search"
                        v-model:text-value.trim="addNameFilter"
                        :text-size="render.addName.filterTextSize"
                        :type="typeof render.addName.type === 'function' ? render.addName.type() : render.addName.type"
                        :width="render.addName.width"
                        placeholder="üîç–î–æ–ø. –Ω–∞–∑–≤–∞–Ω–∏–µ..."
                    />
                </div>

                <div>
                    <!-- __ –°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppLabelMultiLineTS
                        v-if="render.shortName.show"
                        :align="render.shortName.headerAlign"
                        :text="render.shortName.header"
                        :text-size="render.shortName.headerTextSize"
                        :type="typeof render.shortName.type === 'function' ? render.shortName.type() : render.shortName.type"
                        :width="render.shortName.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppInputTextTS
                        v-if="render.shortName.show"
                        id="id-short-name-search"
                        v-model:text-value.trim="shortNameFilter"
                        :text-size="render.shortName.filterTextSize"
                        :type="typeof render.shortName.type === 'function' ? render.shortName.type() : render.shortName.type"
                        :width="render.shortName.width"
                        placeholder="üîç–°–æ–∫—Ä. –Ω–∞–∑–≤–∞–Ω–∏–µ..."
                    />
                </div>

                <div>
                    <!-- __ –ö–æ–¥ –∏–∑ 1–° -->
                    <AppLabelMultiLineTS
                        v-if="render.code1c.show"
                        :align="render.code1c.headerAlign"
                        :text="render.code1c.header"
                        :text-size="render.code1c.headerTextSize"
                        :type="typeof render.code1c.type === 'function' ? render.code1c.type() : render.code1c.type"
                        :width="render.code1c.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                    <AppInputTextTS
                        v-if="render.code1c.show"
                        id="id-code-1c-search"
                        v-model:text-value.trim="code1cFilter"
                        :text-size="render.code1c.filterTextSize"
                        :type="typeof render.code1c.type === 'function' ? render.code1c.type() : render.code1c.type"
                        :width="render.code1c.width"
                        placeholder="üîç–ö–æ–¥ –∏–∑ 1–°..."
                    />
                </div>

                <div>
                    <!-- __ Active -->
                    <AppLabelMultiLineTS
                        v-if="render.active.show"
                        :align="render.active.headerAlign"
                        :text="render.active.header"
                        :text-size="render.active.headerTextSize"
                        :type="typeof render.active.type === 'function' ? render.active.type() : render.active.type"
                        :width="render.active.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: Active -->
                    <AppSelectSimpleTS
                        v-if="render.active.show"
                        :select-data="activeSelect"
                        :text-size="render.active.headerTextSize"
                        :type="
                            activeFilter === 0
                            ? 'primary'
                            : activeFilter === 1
                                ? 'success'
                                : 'danger'
                        "
                        :width="render.active.width"
                        align="center"
                        class="mt-[7px]"
                        height="h-[26px]"
                        @change="filterByActive"
                    />

                </div>

                <div>
                    <!-- __ –†–µ–≥–∏–æ–Ω -->
                    <AppLabelMultiLineTS
                        v-if="render.region.show"
                        :align="render.region.headerAlign"
                        :text="render.region.header"
                        :text-size="render.region.headerTextSize"
                        :type="typeof render.region.type === 'function' ? render.region.type() : render.region.type"
                        :width="render.region.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –†–µ–≥–∏–æ–Ω -->
                    <AppSelectSimpleTS
                        v-if="render.region.show"
                        :select-data="regionSelect"
                        :text-size="render.region.headerTextSize"
                        :type="typeof render.region.type === 'function' ? render.region.type() : render.region.type"
                        :width="render.region.width"
                        align="center"
                        class="mt-[7px]"
                        height="h-[26px]"
                        @change="filterByRegion"
                    />
                </div>

                <div>
                    <!-- __ –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <AppLabelMultiLineTS
                        v-if="render.description.show"
                        :align="render.description.headerAlign"
                        :text="render.description.header"
                        :text-size="render.description.headerTextSize"
                        :type="typeof render.description.type === 'function' ? render.description.type() : render.description.type"
                        :width="render.description.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <AppInputTextTS
                        v-if="render.description.show"
                        id="description-search"
                        v-model:text-value.trim="descriptionFilter"
                        :text-size="render.description.filterTextSize"
                        :type="typeof render.description.type === 'function' ? render.description.type() : render.description.type"
                        :width="render.description.width"
                        placeholder="üîç–û–ø–∏—Å–∞–Ω–∏–µ..."
                    />
                </div>

                <div>
                    <!-- __ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                    <AppLabelMultiLineTS
                        v-if="render.comment.show"
                        :align="render.comment.headerAlign"
                        :text="render.comment.header"
                        :text-size="render.comment.headerTextSize"
                        :type="typeof render.comment.type === 'function' ? render.comment.type() : render.comment.type"
                        :width="render.comment.width"
                    />

                    <!-- __ –§–∏–ª—å—Ç—Ä: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                    <AppInputTextTS
                        v-if="render.comment.show"
                        id="comment-search"
                        v-model:text-value.trim="commentFilter"
                        :text-size="render.comment.filterTextSize"
                        :type="typeof render.comment.type === 'function' ? render.comment.type() : render.comment.type"
                        :width="render.comment.width"
                        placeholder="üîç–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."
                    />
                </div>

                <div>
                    <!-- __ + –ö–ª–∏–µ–Ω—Ç -->
                    <router-link :to="{ name: 'clients.create' }">
                        <AppLabelMultiLineTS
                            :text="['‚ûï', '']"
                            align="center"
                            class="cursor-pointer"
                            text-size="large"
                            type="warning"
                            width="w-[64px]"
                        />
                    </router-link>

                    <!-- __ –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                    <div class=" mt-[8px]">
                        <AppLabelTS
                            id="filters-reset"
                            align="center"
                            class="cursor-pointer"
                            height="h-[26px]"
                            text="–û—á–∏—Å—Ç–∏—Ç—å"
                            text-size="mini"
                            type="orange"
                            width="w-[64px]"
                            @click="resetFilters"
                        />
                    </div>
                </div>


            </div>


        </div>

        <!-- __ –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ -->
        <div v-if="clientsRender.length">
            <div class="pt-1 pb-1 bg-slate-200 border-2 rounded-lg border-slate-700 p-1 mb-1 max-w-fit">
                <div v-for="client in clientsRender" :key="client.id">
                    <div class="flex">

                        <!-- __ id -->
                        <AppLabelTS
                            v-if="render.id.show"
                            :align="render.id.dataAlign"
                            :text="render.id.data ? render.id.data(client) : ''"
                            :text-size="render.id.dataTextSize"
                            :type="typeof render.id.type === 'function' ? render.id.type(client, false) : render.id.type"
                            :width="render.id.width"
                        />

                        <!-- __ –ù–∞–∑–≤–∞–Ω–∏–µ -->
                        <AppLabelTS
                            v-if="render.name.show"
                            :align="render.name.dataAlign"
                            :text="render.name.data ? render.name.data(client) : ''"
                            :text-size="render.name.dataTextSize"
                            :type="typeof render.name.type === 'function' ? render.name.type(client, false) : render.name.type"
                            :width="render.name.width"
                        />

                        <!-- __ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                        <AppLabelTS
                            v-if="render.addName.show"
                            :align="render.addName.dataAlign"
                            :text="render.addName.data ? render.addName.data(client) : ''"
                            :text-size="render.addName.dataTextSize"
                            :type="typeof render.addName.type === 'function' ? render.addName.type(client, false) : render.addName.type"
                            :width="render.addName.width"
                        />

                        <!-- __ –°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ -->
                        <AppLabelTS
                            v-if="render.shortName.show"
                            :align="render.shortName.dataAlign"
                            :text="render.shortName.data ? render.shortName.data(client) : ''"
                            :text-size="render.shortName.dataTextSize"
                            :type="typeof render.shortName.type === 'function' ? render.shortName.type(client, false) : render.shortName.type"
                            :width="render.shortName.width"
                        />

                        <!-- __ –ö–æ–¥ –∏–∑ 1–° -->
                        <AppLabelTS
                            v-if="render.code1c.show"
                            :align="render.code1c.dataAlign"
                            :text="render.code1c.data ? render.code1c.data(client) : ''"
                            :text-size="render.code1c.dataTextSize"
                            :type="typeof render.code1c.type === 'function' ? render.code1c.type(client, false) : render.code1c.type"
                            :width="render.code1c.width"
                        />

                        <!-- __ Active -->
                        <AppLabelTS
                            v-if="render.active.show"
                            :align="render.active.dataAlign"
                            :text="render.active.data ? render.active.data(client) : ''"
                            :text-size="render.active.dataTextSize"
                            :type="typeof render.active.type === 'function' ? render.active.type(client, false) : render.active.type"
                            :width="render.active.width"
                        />

                        <!-- __ –†–µ–≥–∏–æ–Ω -->
                        <AppLabelTS
                            v-if="render.region.show"
                            :align="render.region.dataAlign"
                            :text="render.region.data ? render.region.data(client) : ''"
                            :text-size="render.region.dataTextSize"
                            :type="typeof render.region.type === 'function' ? render.region.type(client, false) : render.region.type"
                            :width="render.region.width"
                        />

                        <!-- __ –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <AppLabelTS
                            v-if="render.description.show"
                            :align="render.description.dataAlign"
                            :text="render.description.data ? render.description.data(client) : ''"
                            :text-size="render.description.dataTextSize"
                            :type="typeof render.description.type === 'function' ? render.description.type(client, false) : render.description.type"
                            :width="render.description.width"
                            class="truncate"
                        />

                        <!-- __ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                        <AppLabelTS
                            v-if="render.comment.show"
                            :align="render.comment.dataAlign"
                            :text="render.comment.data ? render.comment.data(client) : ''"
                            :text-size="render.comment.dataTextSize"
                            :type="typeof render.comment.type === 'function' ? render.comment.type(client, false) : render.comment.type"
                            :width="render.comment.width"
                            class="truncate"
                        />

                        <!-- __ –£–¥–∞–ª–∏—Ç—å -->
                        <AppLabelTS
                            v-if="client.can_edit"
                            align="center"
                            text="üóëÔ∏è"
                            text-size="mini"
                            type="danger"
                            width="w-[30px]"
                            @click="deleteClient(client)"
                        />

                        <!-- __ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å -->
                        <router-link :to="{ name: 'clients.edit', params: { id: client.id } }">
                            <AppLabelTS
                                v-if="client.can_edit"
                                align="center"
                                text="‚úèÔ∏è"
                                text-size="mini"
                                type="warning"
                                width="w-[30px]"
                            />
                        </router-link>

                    </div>
                </div>
            </div>
        </div>

        <div v-else>
            <AppLabelTS
                text="–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
                type="info"
            />
        </div>
    </div>

    <AppModalAsyncMultilineTS
        ref="appModalAsyncTS"
        :mode="modalMode"
        :text="modalText"
        :type="modalType"
    />

    <AppCallout
        :show="modalSimpleShow"
        :text="modalSimpleText"
        :type="modalSimpleType"
    />

</template>


<script lang="ts" setup>
import type { IClient, IRenderData, ISelectData, ISelectDataItem } from '@/types'
import type { IColorTypes } from '@/app/constants/colorsClasses.ts'

import { onMounted, reactive, ref, watchEffect } from 'vue'

// import { useRouter } from 'vue-router'

import { useClientsStore } from '@/stores/ClientsStore'

import AppLabelMultiLineTS from '@/components/ui/labels/AppLabelMultiLineTS.vue'
import AppInputTextTS from '@/components/ui/inputs/AppInputTextTS.vue'
import AppLabelTS from '@/components/ui/labels/AppLabelTS.vue'
import AppCallout from '@/components/ui/callouts/AppCallout.vue'
import AppModalAsyncMultilineTS from '@/components/ui/modals/AppModalAsyncMultilineTS.vue'
import AppSelectSimpleTS from '@/components/ui/selects/AppSelectSimpleTS.vue'

// __ Loader
import { useLoading } from 'vue-loading-overlay'
import { loaderHandler } from '@/app/helpers/helpers.ts'

const clientsStore = useClientsStore()

const isLoading = ref(false)

// __ –¢–∏–ø –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
const modalType = ref<IColorTypes>('danger')
const modalText = ref<string[]>([])
const modalMode = ref<'inform' | 'confirm'>('confirm')
const appModalAsyncTS = ref<any>(null)         // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π

// __ –ü—Ä–æ—Å—Ç–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
const modalSimpleType = ref('danger')
const modalSimpleText = ref('')
const modalSimpleShow = ref(false)
// const modalSimpleClose = (delay = 5000) => setTimeout(() => modalSimpleShow.value = false, delay) // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É


// __ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
const clients = ref<IClient[]>([])
const clientsRender = ref<IClient[]>([])

// __ –§–∏–ª—å—Ç—Ä—ã
const idFilter = ref('')
const nameFilter = ref('')
const addNameFilter = ref('')
const shortNameFilter = ref('')
const code1cFilter = ref('')
const descriptionFilter = ref('')
const commentFilter = ref('')
const activeFilter = ref(0)
const regionFilter = ref(0)


const DEFAULT_HEADER_TYPE = 'primary'
const DEFAULT_DATA_TYPE = 'stone'
const INACTIVE_DATA_TYPE = 'dark'
const HEADER_ALIGN = 'center'
const DATA_ALIGN = 'left'
const HEADER_TEXT_SIZE = 'mini'
const DATA_TEXT_SIZE = 'mini'
const FILTER_TEXT_SIZE = 'mini'

const getType = (client: IClient | null, isHeader: boolean = true) => {
    if (isHeader) return DEFAULT_HEADER_TYPE
    if (!client) return DEFAULT_HEADER_TYPE
    return client.active ? DEFAULT_DATA_TYPE : INACTIVE_DATA_TYPE
}

// __ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–Ω–¥–µ—Ä
const render: IRenderData = reactive({
    id: {
        header: ['id', ''],
        width: 'w-[50px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: 'center',
        data: (client) => client.id.toString(),
    },
    name: {
        header: ['–ù–∞–∑–≤–∞–Ω–∏–µ', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[200px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: DATA_ALIGN,
        data: (client) => client.name,
    },
    addName: {
        header: ['–î–æ–ø. –Ω–∞–∑–≤–∞–Ω–∏–µ', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[150px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: DATA_ALIGN,
        data: (client) => client.add_name,
    },
    shortName: {
        header: ['–°–æ–∫—Ä. –Ω–∞–∑–≤–∞–Ω–∏–µ', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[150px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: DATA_ALIGN,
        data: (client) => client.short_name,
    },
    code1c: {
        header: ['–ö–æ–¥', '–∏–∑ 1–°'],
        width: 'w-[150px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: 'center',
        data: (client) => client.code_1c ?? '',
    },
    active: {
        header: ['–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[100px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => {
            if (isHeader) return DEFAULT_HEADER_TYPE
            return client.active ? 'success' : 'danger'
        },
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: 'center',
        data: (client) => client.active ? '‚úì' : '‚úó',
    },
    region: {
        header: ['–†–µ–≥–∏–æ–Ω', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[100px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: 'center',
        data: (client) => client.region === 'west' ? '–ó–∞–ø–∞–¥' : '–í–æ—Å—Ç–æ–∫',
    },
    description: {
        header: ['–û–ø–∏—Å–∞–Ω–∏–µ', '–∫–ª–∏–µ–Ω—Ç–∞'],
        width: 'w-[250px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: DATA_ALIGN,
        data: (client) => client.description ?? ''
    },
    comment: {
        header: ['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π', '–∫ –∫–ª–∏–µ–Ω—Ç—É'],
        width: 'w-[250px]',
        show: true,
        headerType: DEFAULT_HEADER_TYPE,
        type: (client = null, isHeader: boolean = true) => getType(client, isHeader),
        headerTextSize: HEADER_TEXT_SIZE,
        dataTextSize: DATA_TEXT_SIZE,
        filterTextSize: FILTER_TEXT_SIZE,
        headerAlign: HEADER_ALIGN,
        dataAlign: DATA_ALIGN,
        data: (client) => client.comment ?? ''
    },
})

// __ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç—ã
const activeSelect: ISelectData = {
    name: 'active',
    data: [
        {id: 0, name: '–í—Å–µ', selected: true, disabled: false},
        {id: 1, name: '‚úì', selected: false, disabled: false},
        {id: 2, name: '‚úó', selected: false, disabled: false},
    ],
}

const regionSelect: ISelectData = {
    name: 'region',
    data: [
        {id: 0, name: '–í—Å–µ', selected: true, disabled: false},
        {id: 1, name: '–í–æ—Å—Ç–æ–∫', selected: false, disabled: false},
        {id: 2, name: '–ó–∞–ø–∞–¥', selected: false, disabled: false},
    ],
}

// __ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç—ã
const filterByActive = (value: ISelectDataItem) => {
    activeFilter.value = value.id
}

const filterByRegion = (value: ISelectDataItem) => {
    regionFilter.value = value.id
}


// __ –û–±–Ω—É–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
const resetFilters = () => {
    idFilter.value = ''
    nameFilter.value = ''
    addNameFilter.value = ''
    shortNameFilter.value = ''
    descriptionFilter.value = ''
    commentFilter.value = ''
    activeFilter.value = 0
    regionFilter.value = 0
}

// __ –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
const getClients = async () => {
    clients.value = (await clientsStore.getClients() as IClient[]).sort((a, b) => a.id - b.id)
    clients.value = clients.value.map(client => {
        client.description = client.description ?? ''
        client.comment = client.comment ?? ''
        client.code_1c = client.code_1c ?? ''
        return {...client, can_edit: client.id !== 0}
    })   // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}

// __ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
const getClientsRender = () => clientsRender.value = clients.value

// __ –£–¥–∞–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
const deleteClient = async (client: IClient) => {
    // TODO: –¢—É—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

    return  // Warn! –ù–µ —Ä–∞–∑—Ä–µ—à–∞–µ–º —É–¥–∞–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞

    // modalText.value = ['–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.', '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?']
    // modalType.value = 'danger'
    // modalMode.value = 'confirm'
    //
    // const result = appModalAsyncTS.value.show()             // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∏ –∂–¥–µ–º –æ—Ç–≤–µ—Ç
    // if (result) {
    //     resetFilters()
    //     await clientsStore.deleteClient(client.id)
    //     await getClients()      // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
    //     getClientsRender()      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    // }
}

// const router = useRouter()                 // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–æ—É—Ç–µ—Ä
// const edit = (client: IClient) => {
//     router.push({
//         name: 'clients.edit',
//         params: {id: client.id}
//     })
// }

// const createClient = () => {
//     router.push({
//         name: 'clients.create',
//     })
// }

// __ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
watchEffect(() => {
    clientsRender.value = clients.value
        .filter(client => client.id.toString().includes(idFilter.value.toLowerCase()))
        .filter(client => client.name.toLowerCase().includes(nameFilter.value.toLowerCase()))
        .filter(client => client.add_name.toLowerCase().includes(addNameFilter.value.toLowerCase()))
        .filter(client => client.short_name.toLowerCase().includes(shortNameFilter.value.toLowerCase()))
        .filter(client => client.code_1c!.toLowerCase().includes(code1cFilter.value.toLowerCase()))
        .filter(client => client.description!.toLowerCase().includes(descriptionFilter.value.toLowerCase()))
        .filter(client => client.comment!.toLowerCase().includes(commentFilter.value.toLowerCase()))
        .filter(client => {
            if (activeFilter.value === 0) return true
            else if (activeFilter.value === 1) return client.active
            else if (activeFilter.value === 2) return !client.active
        })
        .filter(client => {
            if (regionFilter.value === 0) return true
            else if (regionFilter.value === 1) return client.region === 'east'
            else if (regionFilter.value === 2) return client.region === 'west'
        })
})


onMounted(async () => {
    isLoading.value = true
    const loadingService = useLoading()
    await loaderHandler(
        loadingService,
        async () => {
            await getClients()      // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
            getClientsRender()      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            // console.log('clients: ', clients.value)
        },
        undefined,
        // false,
    )

    isLoading.value = false
})


</script>

<style scoped></style>
